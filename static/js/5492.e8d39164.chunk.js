"use strict";(self.webpackChunktyphoon=self.webpackChunktyphoon||[]).push([[5492],{4815:(e,n,i)=>{var a,t;function l(e){return e&&"esri.renderers.visualVariables.SizeVariable"===e.declaredClass}function r(e){return null!=e&&!isNaN(e)&&isFinite(e)}function o(e){return e.valueExpression?a.Expression:e.field&&"string"==typeof e.field?a.Field:a.Unknown}function s(e,n){const i=n||o(e),l=e.valueUnit||"unknown";return i===a.Unknown?t.Constant:e.stops?t.Stops:null!=e.minSize&&null!=e.maxSize&&null!=e.minDataValue&&null!=e.maxDataValue?t.ClampedLinear:"unknown"===l?null!=e.minSize&&null!=e.minDataValue?e.minSize&&e.minDataValue?t.Proportional:t.Additive:t.Identity:t.RealWorldSize}i.d(n,{KZ:()=>s,Yf:()=>a,_w:()=>t,eh:()=>o,gf:()=>r,of:()=>l}),function(e){e.Unknown="unknown",e.Expression="expression",e.Field="field"}(a||(a={})),function(e){e.Unknown="unknown",e.Stops="stops",e.ClampedLinear="clamped-linear",e.Proportional="proportional",e.Additive="additive",e.Constant="constant",e.Identity="identity",e.RealWorldSize="real-world-size"}(t||(t={}))},15492:(e,n,i)=>{i.r(n),i.d(n,{getAllSizes:()=>F,getColor:()=>b,getOpacity:()=>m,getRotationAngle:()=>h,getSize:()=>V,getSizeForValue:()=>g,getSizeFromNumberOrVariable:()=>w,getSizeRangeAtScale:()=>y,getVisualVariableValues:()=>S,viewScaleRE:()=>v});var a=i(69539),t=i(39356),l=i(4212),r=i(76460),o=i(3454),s=i(4815);const u=()=>r.A.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),c=e=>u().warn("The visualVariable should be an instance of esri.renderers.visualVariables.".concat(e)),d=()=>u().error("Use of arcade expressions requires an arcade context"),f=new t.A,p=Math.PI,v=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function b(e,n,i){const t="visualVariables"in e&&e.visualVariables?e.visualVariables.find((e=>"color"===e.type)):e;if(!t)return;if("esri.renderers.visualVariables.ColorVariable"!==t.declaredClass)return void c("ColorVariable");const l="number"==typeof n,r=l?null:n,o=null===r||void 0===r?void 0:r.attributes;let s=l?n:null;const u=t.field,{ipData:f,hasExpression:p}=t.cache;let v=t.cache.compiledFunc;if(!u&&!p){const e=t.stops;return e&&e[0]&&e[0].color}if("number"!=typeof s)if(p){if(null==(null===i||void 0===i?void 0:i.arcade))return void d();const e={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},n=i.arcade.arcadeUtils,a=n.getViewInfo(e),l=n.createExecContext(r,a,i.timeZone);if(!v){const e=n.createSyntaxTree(t.valueExpression);v=n.createFunction(e),t.cache.compiledFunc=v}s=n.executeFunction(v,l)}else o&&(s=o[u]);const b=t.normalizationField,m=null!=o&&null!=b?parseFloat(o[b]):void 0;if(null!=s&&(!b||l||!isNaN(m)&&0!==m)){isNaN(m)||l||(s/=m);const e=z(s,f);if(e){const n=e[0],l=e[1],r=n===l?t.stops[n].color:a.A.blendColors(t.stops[n].color,t.stops[l].color,e[2],null!=i?i.color:void 0);return new a.A(r)}}}function m(e,n,i){const a="visualVariables"in e&&e.visualVariables?e.visualVariables.find((e=>"opacity"===e.type)):e;if(!a)return;if("esri.renderers.visualVariables.OpacityVariable"!==a.declaredClass)return void c("OpacityVariable");const t="number"==typeof n,l=t?null:n,r=null===l||void 0===l?void 0:l.attributes;let o=t?n:null;const s=a.field,{ipData:u,hasExpression:f}=a.cache;let p=a.cache.compiledFunc;if(!s&&!f){const e=a.stops;return e&&e[0]&&e[0].opacity}if("number"!=typeof o)if(f){if(null==(null===i||void 0===i?void 0:i.arcade))return void d();const e={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},n=i.arcade.arcadeUtils,t=n.getViewInfo(e),r=n.createExecContext(l,t,i.timeZone);if(!p){const e=n.createSyntaxTree(a.valueExpression);p=n.createFunction(e),a.cache.compiledFunc=p}o=n.executeFunction(p,r)}else r&&(o=r[s]);const v=a.normalizationField,b=null!=r&&null!=v?parseFloat(r[v]):void 0;if(null!=o&&(!v||t||!isNaN(b)&&0!==b)){isNaN(b)||t||(o/=b);const e=z(o,u);if(e){const n=e[0],i=e[1];if(n===i)return a.stops[n].opacity;{const t=a.stops[n].opacity;return t+(a.stops[i].opacity-t)*e[2]}}}}function h(e,n,i){const a="visualVariables"in e&&e.visualVariables?e.visualVariables.find((e=>"rotation"===e.type)):e;if(!a)return;if("esri.renderers.visualVariables.RotationVariable"!==a.declaredClass)return void c("RotationVariable");const t=a.axis||"heading",l="heading"===t&&"arithmetic"===a.rotationType?90:0,r="heading"===t&&"arithmetic"===a.rotationType?-1:1,o="number"==typeof n?null:n,s=null===o||void 0===o?void 0:o.attributes,u=a.field,{hasExpression:f}=a.cache;let p=a.cache.compiledFunc,v=0;if(!u&&!f)return v;if(f){if(null==(null===i||void 0===i?void 0:i.arcade))return void d();const e={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},n=i.arcade.arcadeUtils,t=n.getViewInfo(e),l=n.createExecContext(o,t,i.timeZone);if(!p){const e=n.createSyntaxTree(a.valueExpression);p=n.createFunction(e),a.cache.compiledFunc=p}v=n.executeFunction(p,l)}else s&&(v=s[u]||0);return v="number"!=typeof v||isNaN(v)?null:l+r*v,v}function V(e,n,i){const a="visualVariables"in e&&e.visualVariables?e.visualVariables.find((e=>"size"===e.type)):e;if(!a)return;if("esri.renderers.visualVariables.SizeVariable"!==a.declaredClass)return void c("SizeVariable");const t=g(function(e,n,i){const a="number"==typeof n,t=a?null:n,l=null===t||void 0===t?void 0:t.attributes;let r=a?n:null;const{isScaleDriven:o}=e.cache;let u=e.cache.compiledFunc;if(o){const n=null!=i?i.scale:void 0,a=null!=i?i.view:void 0;r=null==n||"3d"===a?function(e){let n=null,i=null;const a=e.stops;return a?(n=a[0].value,i=a[a.length-1].value):(n=e.minDataValue||0,i=e.maxDataValue||0),(n+i)/2}(e):n}else if(!a)switch(e.inputValueType){case s.Yf.Expression:{if(null==(null===i||void 0===i?void 0:i.arcade))return void d();const n={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},a=i.arcade.arcadeUtils,l=a.getViewInfo(n),o=a.createExecContext(t,l,i.timeZone);if(!u){const n=a.createSyntaxTree(e.valueExpression);u=a.createFunction(n),e.cache.compiledFunc=u}r=a.executeFunction(u,o);break}case s.Yf.Field:l&&(r=l[e.field]);break;case s.Yf.Unknown:r=null}if(!(0,s.gf)(r))return null;if(a||!e.normalizationField)return r;const c=l?parseFloat(l[e.normalizationField]):null;return(0,s.gf)(c)&&0!==c?r/c:null}(a,n,i),a,n,i,a.cache.ipData);return null==t||isNaN(t)?0:t}function w(e,n,i){return null==e?null:(0,s.of)(e)?V(e,n,i):(0,s.gf)(e)?e:null}function x(e,n,i){return(0,s.gf)(i)&&e>i?i:(0,s.gf)(n)&&e<n?n:e}function g(e,n,i,a,t){switch(n.transformationType){case s._w.Additive:return function(e,n,i,a){var t;return e+(null!==(t=w(n.minSize,i,a)||n.minDataValue)&&void 0!==t?t:0)}(e,n,i,a);case s._w.Constant:return function(e,n,i){const a=e.stops;let t=(null===a||void 0===a?void 0:a.length)&&a[0].size;return null==t&&(t=e.minSize),w(t,n,i)}(n,i,a);case s._w.ClampedLinear:return function(e,n,i,a){const t=(e-n.minDataValue)/(n.maxDataValue-n.minDataValue),l=w(n.minSize,i,a),r=w(n.maxSize,i,a),o=null!=a?a.shape:void 0;if(e<=n.minDataValue)return l;if(e>=n.maxDataValue)return r;if(null==l||null==r)return null;if("area"===n.scaleBy&&o){const e="circle"===o,n=e?p*(l/2)**2:l*l,i=n+t*((e?p*(r/2)**2:r*r)-n);return e?2*Math.sqrt(i/p):Math.sqrt(i)}return l+t*(r-l)}(e,n,i,a);case s._w.Proportional:return function(e,n,i,a){const t=null!=a?a.shape:void 0,l=e/n.minDataValue,r=w(n.minSize,i,a),o=w(n.maxSize,i,a);let s=null;return s="circle"===t?2*Math.sqrt(l*(r/2)**2):"square"===t||"diamond"===t||"image"===t?Math.sqrt(l*r**2):l*r,x(s,r,o)}(e,n,i,a);case s._w.Stops:return function(e,n,i,a,t){var l;const[r,o,s]=z(e,t);if(r===o)return w(null===(l=n.stops)||void 0===l?void 0:l[r].size,i,a);{var u,c;const e=w(null===(u=n.stops)||void 0===u?void 0:u[r].size,i,a);return e+(w(null===(c=n.stops)||void 0===c?void 0:c[o].size,i,a)-e)*s}}(e,n,i,a,t);case s._w.RealWorldSize:return function(e,n,i,a){var t;const l=(null!==(t=null===a||void 0===a?void 0:a.resolution)&&void 0!==t?t:1)*o.j[n.valueUnit],r=w(n.minSize,i,a),s=w(n.maxSize,i,a),{valueRepresentation:u}=n;let c=null;return c="area"===u?2*Math.sqrt(e/p)/l:"radius"===u||"distance"===u?2*e/l:e/l,x(c,r,s)}(e,n,i,a);case s._w.Identity:return e;case s._w.Unknown:return null}}function y(e,n,i){const{isScaleDriven:a}=e.cache;if(!(a&&"3d"===i||n))return null;const t={scale:n,view:i};let l=w(e.minSize,f,t),r=w(e.maxSize,f,t);if(null!=l||null!=r){if(l>r){const e=r;r=l,l=e}return{minSize:l,maxSize:r}}}function S(e,n,i){if(!e.visualVariables)return;const a=[],t=[],l=[],r=[],o=[];for(const s of e.visualVariables)switch(s.type){case"color":t.push(s);break;case"opacity":l.push(s);break;case"rotation":o.push(s);break;case"size":r.push(s)}return t.forEach((e=>{const t=b(e,n,i);a.push({variable:e,value:t})})),l.forEach((e=>{const t=m(e,n,i);a.push({variable:e,value:t})})),o.forEach((e=>{const t=h(e,n,i);a.push({variable:e,value:t})})),r.forEach((e=>{const t=V(e,n,i);a.push({variable:e,value:t})})),a.filter((e=>null!=e.value))}function z(e,n){if(!n)return;let i=0,a=n.length-1;return n.some(((n,t)=>e<n?(a=t,!0):(i=t,!1))),[i,a,(e-n[i])/(n[a]-n[i])]}function F(e,n,i){const a=["proportional","proportional","proportional"];for(const t of e){const e=t.useSymbolValue?"symbol-value":V(t,n,i);switch(t.axis){case"width":a[0]=e;break;case"depth":a[1]=e;break;case"height":a[2]=e;break;case"width-and-depth":a[0]=e,a[1]=e;break;case"all":case void 0:case null:a[0]=e,a[1]=e,a[2]=e;break;default:(0,l.Xb)(t.axis)}}return a}}}]);
//# sourceMappingURL=5492.e8d39164.chunk.js.map